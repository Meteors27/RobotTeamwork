# 机器人基础实践报告

<aside>
🏔️ 为了获得更好的阅读体验，强烈建议点击链接 [https://mini-full.notion.site/25c03f8a334842ea8003ac9e75345d85](https://www.notion.so/25c03f8a334842ea8003ac9e75345d85) 阅读本文档！

</aside>

![在开发视觉传感器过程中，高斯模糊后机器人眼中的小组成员，黄色部分为机械爪（及海绵）。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/Untitled.png)

在开发视觉传感器过程中，高斯模糊后机器人眼中的小组成员，黄色部分为机械爪（及海绵）。

**最终考核运行得分：110
历史最高得分：145**

**小组成员：**

- **姚婉婷** 3210100894
- **夏裕诚** 3210101006
- **杨东申** 3210100753
- **王开炫** 3210105636

# 比赛规则及策略

在如图所示的场地内设计并制造一个机器人完成巡线和物块的抓取、放置工作。

[实验打分表.docx](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/2_%25E5%25AE%259E%25E9%25AA%258C%25E6%2589%2593%25E5%2588%2586%25E8%25A1%25A8.docx)

![场地全景图。其他小图为场地细节。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/48F586D9-00E5-4F1A-BE30-ECCD04FF1C0F.jpeg)

场地全景图。其他小图为场地细节。

![9E486D0A-6929-43C7-A12E-D4F69C3C5EB0.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/9E486D0A-6929-43C7-A12E-D4F69C3C5EB0.jpeg)

![B08CA357-158F-4A9C-891C-BB4B49D96162.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/B08CA357-158F-4A9C-891C-BB4B49D96162.jpeg)

![9BBFC14C-EC80-4207-BD55-10A4D52D75D9.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/9BBFC14C-EC80-4207-BD55-10A4D52D75D9.jpeg)

![A14C8BB0-19F0-4B56-A40D-61C34BA9104D.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/A14C8BB0-19F0-4B56-A40D-61C34BA9104D.jpeg)

![2E335D57-9400-4720-9D8B-0E1310C7C7C8.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/2E335D57-9400-4720-9D8B-0E1310C7C7C8.jpeg)

## 场地分析及其所带来的难点

### 巡线部分

由全景图可见，场地的黑线并非闭合，而是在中间有断开，若要完成巡线工作，则要求机器人能够顺利识别障碍物（椅子）并完成避障，再顺利回到线上进行巡线。

此外，场地的白色部分并非全为白色，有些地方灰度较高，起点终点处有红线（但其反光率较高故影响较小）。可能会对巡线尤其是边缘灰度传感器或边缘白标传感器造成影响，导致其误判为T字形黑线。

### 抓取放置部分

抓取和放置的台子对称放置，需要经过上坡下坡才能到达，且下坡之后紧接着转弯，若不做速度上的控制，则冲下坡时可能由于速度过大冲出线外。

抓取的位置设有T形黑线，可以通过在车的右边缘安装一个灰度传感器或者白标传感器来识别右侧的黑线。由于前述的场地原因，边缘传感器很可能把场地上比较脏的地方误判为黑线，从而导致过早的转弯。

抓取部分的台子放有六个物块，颜色随机放置，然而其底部有红绿蓝三种颜色的色块，这就对直接向这个台子使用基于视觉或者其他方法的颜色识别造成了干扰。

## 预期策略

在最后一个晚上，我们想出了三个策略，其主程序代码以分支的形式储存于仓库中。但最终由于时间关系，其余两个策略来不及做进一步的调试，我们就选择了最稳妥的策略。

### 走一圈 丢三个 放三个（最终采用的策略）

本方案预期得分最高可达145分，而我们在测试中也确实曾经达到过这一分数。

在最后一天的傍晚，姚婉婷和杨东申调试出了抓取下排三个物体的机械臂的位姿，为我们实现这部分策略提供了可能。在此之前，我们已经调试出了这个策略所需要的所有函数，于是在最后时间紧张的时候，使用了这个最为稳妥的方法。然而本策略可以进一步改进，详见[王开炫个人总结部分](https://www.notion.so/25c03f8a334842ea8003ac9e75345d85)。

### 走一圈 丢两个 放四个（抓一个在手中）

本方案预期得分最高可达160分，但由于最后时间不足，放弃了这个策略的调试。

### 走两圈 运输六个物块

本方案预期得分最高可达220分，但由于2min时间限制，几乎无法实现。

---

# 机器人设计

## 运动控制部分

![4B6F5108-EC34-49FF-B976-3EC0510B8E23.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/4B6F5108-EC34-49FF-B976-3EC0510B8E23.jpeg)

### 电机

车的底部由两个主动轮和一个万向轮组成，用TB6612芯片的驱动板驱动电机，而电机的转速由`cruise()` 函数根据三个灰度传感器的输入来调整。

### 边缘的白标传感器

右轮前装有一个套件内的白标传感器（与灰度传感器类似），在代码中实例名为 `EdgeSensor` ，类名为`WhiteScaleSensor` 。当这个传感器探测到黑线的时候，根据已经被触发的次数，可以判定为是`grasping`  `placing` `round2`状态，从而做出对应的响应。

### 超声波传感器

在万向轮前安装套件内的超声波传感器，用于检测障碍物并及时触发避障。使用串口监视器测试可知，当距离超过`MAX_DISTANCE`时，`detect()` 调用会获得零返回。且在上坡前可能因为检测到上坡的部分导致提前避障等，因此给超声波传感器设置了`able` 变量，在合适的时候调用其`detect()`.

---

## 机械臂部分

本次设计的五自由度机械臂安装于机器人底盘的前方，便于抓取较远处的物块。

由于采用转盘结构存储物块，机械爪只能以倾斜角度抓取，因此机械爪部分在原有机械臂的基础上加装海绵和橡皮筋，海绵使用橡皮筋固定。**反复缠绕的橡皮筋在保证了一定容错率的同时，也能够为抓取在中间的物块提供较大的摩擦力**（事实上机械臂中间的部分较宽，很难抓紧物块，橡皮筋有弹性，在机械臂合拢的时候能够提供足够的容错率，不至于直接打倒物块无法抓取）。

机械臂的运动控制通过向数字舵机发送指令来实现，通过参数的调整预设了几个位姿参数，储存对应动作的目标状态，不同位置物块的抓取和放置都可以通过相应几个目标状态之间的转换实现，以抓取第二级台阶正中间物块为例，抓取过程机械臂的运动可以简化为：

1. 机械臂到达物块上方`forward_up`（位姿1）
2. 开爪
3. 下降至`forward_down`（位姿2）
4. 合爪-抬升至`forward_up`（位姿1）
5. 旋转180度到达转盘正上方`back_up`（位姿3）
6. 下降至`back_down`（位姿4）
7. 开爪。

放置过程类似，具体代码实现请见后面部分。

![8A701DD2-2C99-4F79-9749-BF67765B09BB.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/8A701DD2-2C99-4F79-9749-BF67765B09BB.jpeg)

![54709185-5884-4368-9157-FC32BC65CDED.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/54709185-5884-4368-9157-FC32BC65CDED.jpeg)

## 物块存储部分

### 转盘

物块存储部分主体由一个转盘组成。转盘有上下两层，中间通过螺柱连接，下层用于托载物块，上层中间镂空成三叶形，用于限位，防止小车运载物块上下坡过程中物块掉落。

![AAECF63A-8B59-457C-A296-779B696D5A8E.png](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/AAECF63A-8B59-457C-A296-779B696D5A8E.png)

为了增加容错率，镂空部分直径略大于物块对角线长度；在此基础上为了增大从转盘上抓取物块的准确度，我们设计了以下几种类型的物块用于粘在下层转盘上：

- 三棱锥形
    
    ![8B51C5DD-C577-41CA-BB90-42F538D51D66.png](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/8B51C5DD-C577-41CA-BB90-42F538D51D66.png)
    

- 半椭球形上带锥顶

![D4658329-F4CE-417A-8CA6-55A420A3A507.png](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/D4658329-F4CE-417A-8CA6-55A420A3A507.png)

- 半椭球形
- 半椭球形上带半球突起

最终我们选择了半椭球形、中间有球形突起的结构，粘在下层置物板上（见下图），这样**上小下大的结构使得物块底部任一点落在球形突起上，都会因为上层转盘和下层结构的合力矩作用而旋转，最终正落到底层转盘上并保持稳定。**都可以从该机构上滑落，最终物块重心位于圆盘镂空处中央，使得物块放置位置在可接受误差范围内精度达到最高。（实际测试过程中发现，偏大的软质镂空上层板可以在放置不准的情况下转动时把物块震落到原定位置）。

此外，为了防止不同“叶片”中的物块相互滑动，在下层转盘中央加装6cm高的柱子，柱子也通过3D打印制作，模型见右图。起到分割作用。

![A51C6D75-8CC1-45E1-B994-3E0F3BF2BAEB.png](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/A51C6D75-8CC1-45E1-B994-3E0F3BF2BAEB.png)

转盘原为硬卡纸质，但是为了提高强度，防止被机械臂多次损坏，我们绘制模型采用3D打印方式重制了转盘。由于金工中心3D打印所用材料都带有颜色，且能正常工作的打印机所有材料恰好都为三原色，我们采用蓝色PLA材料打印，**为防止转盘的蓝色干扰颜色识别，用记号笔将转盘和突起结构涂成黑色**。

此外，在运动过程中，机械臂保持`back_down` 位姿，覆盖于三个物块之上，起到盖子的作用，可以避免小车在运动过程中由于上下坡的颠簸导致物块从中掉落，同时也使重心降低而不致翻车。

![转盘俯拍，下方原应有半椭球状物块，本图展示了物块和底盘的连接方式：胶水连接。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/FB542708-27F5-4B59-9DF3-DB5830AA3B6A.jpeg)

转盘俯拍，下方原应有半椭球状物块，本图展示了物块和底盘的连接方式：胶水连接。

![小车在上下坡时的机械臂位姿，防止物块掉落。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/13B0CC63-33B7-49C3-9A03-813261947EAB.jpeg)

小车在上下坡时的机械臂位姿，防止物块掉落。

### 颜色识别

在转盘的一侧，使用了助教统一采购的颜色识别传感器，对抓取到的物块进行颜色识别与记忆。在我们的实现中，其`detect()` 会返回`”red”` `“blue”` `“green”` `“unknown”` . 

右图中转盘边即为颜色传感器。抓取到物体后，转盘转动为下一次抓取腾出空间，同时传感器进行颜色识别。

![图中转盘左侧为颜色传感器。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/C20CF7CE-6F4B-4B72-9200-ADBB6CC1D46C.jpeg)

图中转盘左侧为颜色传感器。

![右轮上前部分为颜色传感器。](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/6FA579C1-2B17-4A1C-AE78-A883615F0561.jpeg)

右轮上前部分为颜色传感器。

## 其他小设计

在机器人的设计中，还加入了`CK008` 电容式触摸传感器和RGB LED灯。

触摸传感器可以在调试的时候**给机器人手动下达指令**，方便调试，也能避免一通电小车就开始运动最终从桌面掉落的惨剧发生。在最终的主程序中，也作为启动开关，将舵机等的初始化这一耗时较久的过程移动到比赛计时开始前完成，节省时间。LED灯可以在调试的时候让机器人**给予我们十分确定的反馈**，进入某个函数时、状态改变时、颜色识别成功时，可以亮起特定颜色的灯光，大大便利了调试过程。

![C20CF7CE-6F4B-4B72-9200-ADBB6CC1D46C.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/C20CF7CE-6F4B-4B72-9200-ADBB6CC1D46C.jpeg)

另外，注意到当机械臂抓取右前方物块的时候，由于我们设计的小车底盘较小，车体出现倾斜，几近翻车，因此在车前方伸出两片长板，在抓取、放置的时候，两片长板恰好按在物品放置台上，提供向上弹力，避免翻车。

![49B06F28-5A32-43FC-9F0B-0BC2A480454E.jpeg](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/49B06F28-5A32-43FC-9F0B-0BC2A480454E.jpeg)

---

# 项目代码

本项目代码均托管于‣, 其中主程序为`robot/robot.ino`, 自主编写的库在`./library/`下. 

在为每一个传感器编写cpp库时，我们使用了串口监视器进行调试，这部分调试代码也被保留在仓库中，而这在后面我们排查传感器硬件故障等问题时为我们提供了非常大的帮助，在编写库时，传感器测试代码也可以作为应用场景，帮助我们定义接口并将其实现。

## 主程序控制流

全局变量中的`cornerCount` 变量用于记录经过T字形路口的次数，当`cornerCount` 为1时，判定为`grasping`状态，为2时，判定为`placing` 状态，在这两个状态之间时，允许超声波传感器返回非0值。

机器人在一开始使用巡线，在部分较脏的场地，使用读秒强制巡线（相当于禁用了其他动作，只做巡线，避免错误的判别），上坡识别到T字黑线后，电机制动刹车，右转后使用严格慢速巡线`cruise_slowly_strictly()` ，确保停于台前时，位姿基本稳定。（注：经多次调试，发现在转弯前让电机直接制动能够使停止更加稳定，为后面开环控制的精确抓取与放置创造条件。）

转弯并停止于台前后，根据`cornerCount`的值判定调用`block_grabbing()` `block_placing()`函数。在此过程中，由于涉及左转右转等等操作，很可能导致边缘传感器误以为到达下一个T字路口，因此大部分函数中包含了`delay()` 的调用，确保整个过程在一次`loop()` 调用内完成，后期调试中使用了边缘白标传感器库中的`disable()` 函数，使之不致误判。

`block_grabbing()` : 在运行`block_grabbing()` 时，机器人重复以下动作：

张手→抬手→手移动至目标物块位置并抓住物块→转盘转动至空位在机器人正后方→讲物块放入空位→若非第一次抓取, 调用颜色传感器进行颜色识别, 若识别结果为红绿蓝之一, LED亮对应的颜色, **将物块在转盘上的位置与该物块颜色建立映射**.

`block_placing()`: 在运行`block_placing()` 时, 机器人重复以下动作: (伪代码)

```
if blue block exists:
	rotate the plate to the place marked as blue
	grab the block
	place the block on the topleft place (whose color is blue)
```

对红色, 绿色的物块采取类似的操作。由于放置物块区域的颜色是固定的，因此只需要识别物块的颜色即可完成准确的放置，此外，如果识别不到三原色，则直接放弃放置动作，节省时间（由于颜色传感器经过测试证明非常可靠，因此识别不到颜色极大概率为抓取时问题）。

在下坡时，由于坡面较陡，机器人容易直接冲出线外，因此在坡上我们使用`cruise_down_hill()` 函数，这个改进版的巡线参数速度更慢且更加严格，保证机器人一直在线上。

而在避障部分，我们为了机器人能够走得优雅，同时也为了提升其稳定性，并未采取触觉传感器的方案，而是使用超声波传感器，在被障碍物阻挡时提前避障。当超声波传感器看到障碍物时，机器人读秒转弯直行，直行的过程并不读秒，而是直行至灰度传感器看到黑线时，使用巡线使其回到线上。

值得一提的是，在避障到达下一条线时可能出现边缘传感器误判为黑线的情况，在抓取物块时，我们将边缘传感器禁用，在避障结束，强制巡线一段时间后，认为机器人已经在正常巡线状态，此时启用边缘传感器。

机器人回到起点后，`round2` 置真。但由于我们最终采用的策略是只走一圈，因此对于第二圈的控制并未再做维护，此处不再赘述。

## 值得一提的细节

本次项目代码为了方便多人协作，使用`git`作为版本管理工具，并将代码托管于`github` （仓库见‣），这对我们保留之前的参数和模型都非常重要。在之前我们对巡线代码做了一次复杂度过高的修改，便使用`git`回滚至之前的版本，为调试和协作提供了莫大的便利。

本代码中大部分的函数设计都考虑了一般性和抽象化，避免了冗余，如`rotate(int angle, Servo* servo)` 函数可以用于控制任何一个舵机，对各种传感器库也做了封装。

考虑到项目代码具有小组协作完成的特性，代码的可读性要求较高，基本上大部分代码段都通过合适的变量、函数名选用做了自注释，对于部分比较复杂的函数，也用标准的方式写了注释。

---

# 机器人调试

调试过程主要包括模型的修改和参数的调整。参数调整部分不再赘述。在调试过程中，我们遇到的部分问题及对应解决策略如下：

| 机器人在满载情况下难以上坡 | 试图自己制造更大的万向轮（最终弃用）；为上坡部分定制了速度更快的巡线函数。 |
| --- | --- |
| 机器人避障过程中边缘传感器过于敏感误判黑线 | 调整边缘传感器的阈值；使用disable() 函数在不该触发时禁用边缘传感器 |
| 机器人抓取物块时底盘不稳，几近翻车 | 在车前伸出两个长板，抓取放置时卡住载物台。 |
| 机器人下坡时冲出线外 | 在下坡前控制初速度，为下坡定制一个几乎不加速的cruise_down_hill()  |
| 机器人停在台前的位置稳定性差 | 在转弯前先制动，转弯后，使用严格的巡线函数，本部分尽可能减少开环控制比例。 |

---

# 曾经做过的探索

## 失败的四边形结构

在第一天，姚婉婷和王开炫试图通过机械结构将舵机产生的旋转运动转化为平行运动，为此我们使用了导论课中讲到的平行四边形结构，经过一天的设计和制造后，最终由于其效率过低而被放弃。

## 摄像头识别与树莓派

夏裕诚和王开炫从零部署树莓派，安装系统并通过`ssh`连接树莓派并配置好了`VNC` 虚拟显示器，使用`OpenCV`实现了基于视觉的颜色识别，并能在画面中分割出色块。

## 带MCU的颜色传感器

我们购置了一款带MCU的，更为高级的颜色传感器，夏裕诚花费大量时间透彻研究了`IIC`总线，软串口通信，寄存器指令，并为该款颜色传感器编写了类库。当传感器能够稳定识别颜色时，它被安装在了机器人小车上。奇妙的是，安装之后颜色传感器却不能识别，经过故障排查，我们团队认为颜色传感器已损坏，不能正常工作。

## 万向轮

由于万向轮前轮半径过小，上容易卡住，姚婉婷使用探索者零件设计了一个更大的万向轮。该万向轮设计精巧，越野性能强，可是由于安装之后转向阻力过大，抱憾赋闲在桌。

## 舵机旋转支架

出于对最下方的机械臂旋转舵机饱受压力的同情和担忧，我们为它设计了一个支架，轴向压力和径向压力的大部分会由支架承担，避免舵机损坏。

---

# 测试视频：最高测试得分为145分，录制视频最高分140分。

[IMG_1174.MOV](%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5%E6%8A%A5%E5%91%8A%2025c03f8a334842ea8003ac9e75345d85/IMG_1174.mov)

---

# 个人分工 总结与感想

**在本次机器人基础实践中，由于整个系统极难完全解耦，因此大部分工作事实上是由小组成员共同参与、共同调试的。**

我们四人在经历了前期的探索，基本确定最终方案后，可以粗略分为两个小组，杨东申和姚婉婷主要负责机械结构的设计和机械臂的调试，而夏裕诚和王开炫主要负责偏软件层面的问题。

## 王开炫

在本次机器人基础实践课中，我主要负责**主程序的编写和维护、部分传感器的接口并实现、机器人巡线（乃至于最后整体的调试）以及本实验报告主体部分的编写。**其中，我设计的接口及实现包括：

- LED：提供`set_rgb()` 接口可以在理论上显示$256^{3}$种颜色，并提供了常用的颜色如`white()` `red()` `turnoff()`等。
- 触摸传感器（CK008）：提供`detect()` 检测是否触摸。
- WhiteScaleSensor边缘白标传感器：提供`detect()` 返回是否检测到黑线，`disable()` `enable()` 函数在合理的位置禁用本传感器，以免在转弯时或避障即将上线时或场地较脏处出现错误的返回。

我大概是我们小组里面唯一没有相关竞赛经历的人，非常荣幸能再次和这几位好友一起组队，在第一天，事实上我对于套件内的大部分传感器等都是非常陌生的，我的三位组员在课程前期给予了我莫大的帮助，在此致以诚挚的感谢（磕头）。

虽然没有做过机器人，但我一开始以之前软件工程的经历，推测这门课程在前几天将有序进展，而后面随着负进度的出现可能使我们变得焦头烂额——这门课程如我想象中的那样，得益于小组内其他成员超强的工程能力，我们仅用了几个小时就完成了基本巡线的任务，但最后几天则往往停滞不前，预期能实现的分数时高时低。

### 一点遗憾

在小车的电路设计和底盘基本完善的时候，我开始接手主程序，和夏裕诚共同编写传感器的库，在选择合适的传感器上做了一些探索。我们实现了在树莓派OS上部署`PiCamera` 进行颜色识别和色块分割，但最后在主观上由于畏难心理搁置了树莓派摄像头方案的部署。虽然最后我们在不使用视觉的情况下，也实现了一套理论上能满足所有需求的硬件及其驱动，但我后来仍然认为，如果我们有足够的时间来完成视觉传感器的部署，在很多地方就不必再用开环控制，虽然最后的分数未必会更高，但我认为这将在理论上提高整个系统的稳定性。比如，如果我们能使用摄像头提供对应颜色物块的位置信息，便可以在机械臂上使用反馈控制，在深度信息已知的情况下（我们完全可以控制小车停于台前），我们可以获得物块的全部信息，从而在抓取和放置时极大地降低失误率，也免去了反复调参的麻烦。

又如，我负责的主程序逻辑上大可以再做优化：如果颜色传感器没有识别到被正确放入的物块，这种情况大概率是没抓起来，而不是没放在转盘上。我应该在下层抓取一个物块然后放入这个空位中，再在另一边放置在那个缺失的颜色上。我知道，由于时间上不允许婉婷和东申再去调出往下面一行放置的参数，这个物块的颜色匹配势必是无法保证的，然而，只是做出我前面几句话的修改，在抓取失误的情况下仍有希望多拿15分。我在时间有限并且之前部分调试受挫的情况下，对自己的代码能力出现了一点不自信，认为我写了这部分代码还需要去做新的测试（事实上这部分改动我只需要5~10分钟就可以完成），而把时间匀到了测试整个机器人的整圈动作，期望录制一个更高分的视频上。这是这门课上我关于我自己负责的部分仍有的遗憾。

### 许多收获

在这次课程中，我的与机器人相关的**工程能力**得到了很大的提高。在此之前，我并没有接触过这么复杂的硬件系统，仅有的经验只是代码上做过比这复杂得多的项目。这门课程让我对机器人的硬件有了直观而全面的认识。而非常重要的一点是，我认识到了在脱离ROS和反馈的条件下，机器人的控制是高度依赖于硬件的，尽管我们将主程序上传至开源社区，这也并不能为这个世界做出些什么贡献，这和我之前对于coding的认知是完全不一样的。

在和夏裕诚同学的合作中，我也掌握了不少新技能、锻炼了一些旧技术。在我们一起开发的过程中，我充分的感受到了团队协作时整个team内部技能的渗透，此前我并未接触过树莓派，对串口通信等也并无了解，在我们的探索中，我对环境的配置，对工程代码的编写都变得更加熟悉。在本次项目中我们的git仓库一共有160余个提交，在我自己一个几百commit的项目之后，这是我的第一个多人协作项目，我对git的分支管理、标签管理也更加熟练了。

当然，最重要的一件事是，在这门课程中我们收获了**友谊**。机器人基础实践给我们带来了非常快乐的合作体验，在合作中互相学习，通力合作，共同进步，我惊叹于我队友对机器人工程了解之全面、对机械臂调参之迅速、设计的机器人结构之精巧……我也享受着我们在午后的一同漫步，在又取得一些进展后的欢欣。

结课之后我跟我的不少朋友，乃至于在浙大潮汕同乡会的迎新会上屡次提起这门课程，我认为2022年的9月最初的八天会永远铭刻在我的本科生涯记忆里，混杂着疲惫与快乐，回味起来略带着一点遗憾和许多收获，难得有本科课程能带给我如此丰富的体验和收获。再次感谢王老师、赵助教和我的组员们，希望机器人工程的本科教学能越来越好！

---

## 夏裕诚

在本次机器人的设计过程中，我主要负责**编写传感器和电机驱动的类库，搭建小车底盘，设计并搭建电路，建模并3D打印物块存储转盘，和王开炫共同设计小车`Arduino`代码的巡线部分。**

其中，我编写的类库包括：

- 电机驱动（提供`run()`接口实现便捷的调速、正反转功能；提供`stop()`和`brake()`接口实现停止和制动）
- 三路循迹模块驱动（提供`detect()`接口返回线和车的相对偏离程度）
- 颜色传感器驱动（提供`color()`接口实现准确的颜色识别）
- 边缘传感器驱动

机器人小车设计不可避免地伴随着大量的探索与试错。在课程中期，我和王开炫花了一天多时间尝试树莓派的摄像头部署和颜色识别。当我们成功在树莓派上运行颜色识别程序并实现Arduino和树莓派的串口通信时，却由于种种原因只能做罢。我们还反复迭代小车底盘，大量拆装零件，尝试不同的传感器……这些工作看似繁复、大量、原地踏步，甚至会逆水行舟，不进则退。稳定的小车底盘和可靠的电路连接让后续调试不再排查短路断路等于硬件故障，大大提高调试效率；3D建模的快速设计和迭代来源于过往的生疏和练习；甚至我相信，这次没有用上的基于OpenCV的视觉，在下次的机器人设计过程中也必然成为一块垫脚石。在这些曲曲折折的路上，小车稳步前进，我们也得以学习更为广泛的知识技能。

如何在有限的时间内合理分工，高效合作也是本次实践课程让我思考的问题。囿于机械臂的精度，我们只能实现机械臂的开环控制。而这对小车巡线一致性提出了很高的要求。也就是说，每次小车在路口转向必须停在相同的位置，1cm的偏差便可能带来灾难。于是，当我们调整好机械臂时，发现巡线稳定性不足；而巡线程序的修改势必导致小车停止位置有细微差异，继而返回去修改机械臂参数。负责巡线的同学和负责机械臂的同学往往不能同时工作。即便合作顺畅如我们，也难以杜绝此类现象。如果工程规模更加庞大，人数变得更多，协调、合作效率的作用会愈发凸显。

最后，我很感谢彻夜通力合作的队友们，是他们提出各种富有新意的解决方案，共同商榷问题可行性，并高效地将创意变成现实，我们才能快速迭代、推陈出新。此外，我们之间的信任、默契、友谊不会伴随课程的结束而消逝。

---

## 姚婉婷

在本次机器人的设计过程中，我主要负责**设计和制作载物转盘（前期纸质版），安装调试机械臂和载物转盘，改造机械爪以增大摩擦，和杨东申共同设计了小车`Arduino`代码的机械臂部分并完成调参。**

其中，

- 在杨东申提出的载物转盘设想基础上，我设计了用于精确限位又有相当容错率的锥形块结构
- 机械爪原先通过加垫海绵增大摩擦，后来出现舵机无法转动到位，发生疲软导致物块脱落的现象，我询问王老师后决定采用皮筋+海绵的形式进一步增大摩擦，保护舵机
- 为了提高机械臂调参效率，我们将抓取物块、放置物块两个环节的机械臂运动状态抽象成各个位姿之间的转换。通过断电状态下手动调整机械臂各个自由度的状态，拍摄照片，对照照片进行调参，后期制作简易舵机指示盘，形成经验值，进一步提高调参效率。

机器人的设计制作是一个软硬件联调的过程，其中硬件工作状态不稳定给我们的调参带来偌大的困难。虽然最初使用了优质的电机，但使用过程中硬件损坏的问题仍无法避免。整车机械结构搭建完成的时候我们就意识到了支撑机械臂转盘的舵机仅凭转轴和塑料舵盘承受机械臂重量带来的不稳定性，尝试搭建支架解决，可惜后来仍因剧烈晃动而不得已更换为金属舵盘；机械爪之间加垫海绵的方案导致控制机械爪的舵机频繁卡住，寿命下降，课程进行到中期时突然罢工，只好更换舵机并改变抓取方案；最惊险的是验收那天的凌晨，由于新增抓取第一级台阶物块的计划，机械臂最下面一节舵机卡住，频繁出现疲软现象，我们一度产生功亏一篑的绝望感，幸而没有放弃，利用现场舵机完成更替，反而提高了抓取稳定性......类似问题在往后的实践课程乃至机器人竞赛中也必然会反复出现，除了预防之外，我们也要学会心平气和地排查故障，解决问题。

小组合作也是课程推进过程中重要的一环，我们在设计过程中提出自己的想法，并逐渐形成明确的任务分工。课程后期我们采取了轮班制，循线和机械臂分开调节，也因此获得了比其他小组更充裕的时间。然而这样也带来一些问题，比如机械臂抓取高度依赖于停车位置，循线代码一旦修改机械臂便需要相应微调（当然，这也是开环控制不可避免的，除非利用视觉伺服实现闭环）。虽然机器人设计和制作过程中遇到诸多困难，前期经常做无用功甚至不进反退，但大家都十分乐观地面对，如等舵机的间隙散步去银泉吃饭，调试间隙用高糊摄像头拍合影等等，给实验室带来欢声笑语。私以为轻松愉快的合作氛围对最后机器人调试的成功有着不可忽略的作用。

最后，感谢夏裕诚和王开炫调试的非常稳定的循线代码，让我们的机械臂参数有用武之地；感谢杨师傅任劳任怨地修车，对整车拆装了不下五六遍；感谢大家完善至臻的调试精神，把我们的小车打造成一件艺术品。虽然验收只拿了110分，距离目标得分有所差距，但装小车的整个过程，仍是一段难忘而美好的回忆。

---

## 杨东申

在本次机器人基础实践课程中，我主要负责**机器人部分结构的设计、机器人的装配与检修、机械臂的调试的工作。**

机器人结构设计部分，主要参与了**物块储存部分的设计**，初步设计了储物转盘。储物转盘保证机械臂可以在同一位点放置物块，减少了机械臂位姿数量，简化了机械臂位姿调整的工作。另一方面，转盘与颜色传感器联动，可以减少颜色传感器数量，有效提高使用效率。但在实际执行过程中也遇到了诸多问题，例如不同物块在抓取后与机械爪相对位置不同，导致放置位置出现偏差，物块掉落，实际实践过程中仍需对机械臂位姿进行细微调整。

在实践过程中还负责了部分的**机器人装配工作**。在机器人初步设计与后续改动过程中拆装机器部件，设计部分传感器、机械臂和载物模块的安装位置。零部件的叠加给后期元件的装配带来了很多困难，且机器人各模块之间的运动会相互影响。频繁的拆装也导致了螺栓螺母松动、零部件掉落的情况，影响了结构强度，零部件之间的相对移动也影响了机械臂精度。反思发现，在机器人设计过程中应更具前瞻性，避免频繁拆装；装配应注重顺序，避免部件装配相互影响；需要较大的机械强度的位点用螺栓螺母连接时应多利用垫圈、螺丝胶等加固。

本次实验较多时间用于与姚婉婷同学一同完成**机械臂的调试**。在机械臂抓取部分我们采用了开环控制，固定机械臂在不同状态下的位姿，让机械臂按固定的流程与参数运行。这种简单的控制方法虽然简化了算法，但精度较低，且对小车抓取前停止的位置有较高要求，一旦小车停止位置有偏差就会出现无法抓取的情况。由于缺乏机器人逆运动学的知识，调节机械臂关节角的过程采取了最简单的方法，具体流程为：手动调整到目标位置、目测角度、录入程序运行后与目标位置对比、反复调整角度数据。这种调整方法效率较低，耗时长，且可能因电池电源电压，小车抓取时停放位置等环境因素的微小改变，无法抓取到物块。

机械臂的调整过程让我初步了解舵机的性质，理解了机器人运动学的重要性，同时也对开环控制与闭环控制的优劣有了初步认识。虽然最终采用了开环控制的方法，但我们对机械臂位姿反馈、机器视觉等的尝试增长了我们对闭环控制的知识。

在本次课程中，我主要负责了一些基础性的工作，希望在以后的学习中能更多的接触传感器代码、巡线算法等本次课程中未深入了解内容。在最后要感谢我的队友以及其他组同学对我的帮助、鼓励、包容，帮助我在这项课程中更好的实践自己的设想。

---